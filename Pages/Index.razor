@page "/"
@inject IDbContextFactory<AppDbContext> DbFactory

<MudTable Items="@games" Hover="true" Striped="true">
    <ToolBarContent>
        <MudText Typo="Typo.h6" Class="mr-5">Games</MudText>
        <MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Add" Color="Color.Primary"
            Href="/game/create">
            Add Game
        </MudButton>
    </ToolBarContent>
    <HeaderContent>
        <MudTh>Game</MudTh>
        <MudTh>Export Name</MudTh>
        <MudTh>Agents</MudTh>
        <MudTh>Action</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd>@context.DisplayTitle</MudTd>
        <MudTd>@context.ExportTitle</MudTd>
        <MudTd>@context.Agents.Count</MudTd>
        <MudTd>
            <MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.RemoveRedEye" Color="Color.Primary"
                Href=@($"/game/{context.Id}")>View</MudButton>
            <MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Edit" Color="Color.Primary"
                Href=@($"/game/edit/{context.Id}")>Edit</MudButton>
        </MudTd>
    </RowTemplate>
</MudTable>

@code {
    private List<Game> games = new();
    protected override void OnInitialized()
    {
        base.OnInitialized();
        using var context = DbFactory.CreateDbContext();
        games = context.Games.OrderByDescending(g => g.Id).Include(g => g.Agents).ToList();
    }
}